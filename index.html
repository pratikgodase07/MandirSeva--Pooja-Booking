<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MandirSeva - Pooja Booking</title>
    <!-- React and ReactDOM -->
    <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.development.js"></script>
    <!-- react-big-calendar -->
    <link href="https://cdn.jsdelivr.net/npm/react-big-calendar@1.8.1/lib/css/react-big-calendar.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/react-big-calendar@1.8.1/lib/react-big-calendar.min.js"></script>
    <!-- Moment.js for calendar -->
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
    <!-- External CSS -->
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div id="root"></div>
    <script type="text/javascript">
        const { useState, useEffect, createContext, useContext } = React;

        // Auth Context for managing user state
        const AuthContext = createContext();

        // Mock API calls (replace with actual backend endpoints)
        const api = {
            login: async (email, password) => {
                return new Promise((resolve) => setTimeout(() => resolve({
                    token: 'mock-jwt-token',
                    user: { id: '1', name: 'John Doe', email, role: 'resident', flatNumber: 'A101' }
                }), 500));
            },
            register: async (name, email, password, flatNumber) => {
                return new Promise((resolve) => setTimeout(() => resolve({ success: true }), 500));
            },
            forgotPassword: async (email) => {
                return new Promise((resolve) => setTimeout(() => resolve({ success: true }), 500));
            },
            getBookings: async () => {
                return new Promise((resolve) => setTimeout(() => resolve([
                    { id: '1', userId: '1', bookingDate: new Date(2025, 9, 20), status: 'approved' },
                    { id: '2', userId: '1', bookingDate: new Date(2025, 9, 25), status: 'pending' }
                ]), 500));
            },
            createBooking: async (date) => {
                return new Promise((resolve) => setTimeout(() => resolve({ success: true }), 500));
            },
            getAdminBookings: async () => {
                return new Promise((resolve) => setTimeout(() => resolve([
                    { id: '1', userId: '1', bookingDate: new Date(2025, 9, 20), status: 'approved', userName: 'John Doe', flatNumber: 'A101' },
                    { id: '2', userId: '2', bookingDate: new Date(2025, 9, 25), status: 'pending', userName: 'Jane Smith', flatNumber: 'B202' }
                ]), 500));
            },
            updateBooking: async (id, status) => {
                return new Promise((resolve) => setTimeout(() => resolve({ success: true }), 500));
            },
            blockDate: async (date) => {
                return new Promise((resolve) => setTimeout(() => resolve({ success: true }), 500));
            }
        };

        // Auth Provider
        function AuthProvider({ children }) {
            const [user, setUser] = useState(null);

            const login = async (email, password) => {
                const response = await api.login(email, password);
                setUser(response.user);
                return response;
            };

            const register = async (name, email, password, flatNumber) => {
                const response = await api.register(name, email, password, flatNumber);
                return response;
            };

            const logout = () => setUser(null);

            return React.createElement(
                AuthContext.Provider,
                { value: { user, login, register, logout } },
                children
            );
        }

        // Login Component (Enhanced with Gods Background and Styling)
        function Login() {
            const { login } = useContext(AuthContext);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');

            const handleSubmit = async function (e) {
                e.preventDefault();
                try {
                    await login(email, password);
                } catch (err) {
                    setError('Invalid credentials');
                }
            };

            return React.createElement(
                'div',
                { className: 'login-bg' },
                React.createElement(
                    'div',
                    { className: 'max-w-md w-full p-8 glass-card rounded-xl animate-fade-in' },
                    React.createElement('h2', { className: 'text-3xl font-bold text-center text-amber-800 mb-6' }, 'MandirSeva Login'),
                    error && React.createElement('p', { className: 'text-red-400 bg-red-900/30 p-2 rounded mb-4 text-center' }, error),
                    React.createElement(
                        'div',
                        { className: 'space-y-6' },
                        React.createElement(
                            'div',
                            null,
                            React.createElement('label', { className: 'block text-amber-700 font-semibold mb-1' }, 'Email'),
                            React.createElement('input', {
                                type: 'email',
                                placeholder: 'Enter your email',
                                value: email,
                                onChange: (e) => setEmail(e.target.value),
                                className: 'w-full p-3 bg-white/80 border border-amber-200 rounded-lg input-focus text-amber-900 placeholder-amber-400'
                            })
                        ),
                        React.createElement(
                            'div',
                            null,
                            React.createElement('label', { className: 'block text-amber-700 font-semibold mb-1' }, 'Password'),
                            React.createElement('input', {
                                type: 'password',
                                placeholder: 'Enter your password',
                                value: password,
                                onChange: (e) => setPassword(e.target.value),
                                className: 'w-full p-3 bg-white/80 border border-amber-200 rounded-lg input-focus text-amber-900 placeholder-amber-400'
                            })
                        ),
                        React.createElement('button', {
                            onClick: handleSubmit,
                            className: 'btn-aesthetic w-full'
                        }, 'Login'),
                        React.createElement(
                            'div',
                            { className: 'flex justify-between text-sm' },
                            React.createElement('a', { href: '#forgot-password', className: 'text-amber-600 hover:text-amber-800' }, 'Forgot Password?'),
                            React.createElement('a', { href: '#register', className: 'text-amber-600 hover:text-amber-800' }, 'Create an Account')
                        )
                    )
                )
            );
        }

        // Register Component
        function Register() {
            const { register } = useContext(AuthContext);
            const [name, setName] = useState('');
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [flatNumber, setFlatNumber] = useState('');
            const [error, setError] = useState('');

            const handleSubmit = async function (e) {
                e.preventDefault();
                try {
                    await register(name, email, password, flatNumber);
                    window.location.hash = '';
                } catch (err) {
                    setError('Registration failed');
                }
            };

            return React.createElement(
                'div',
                { className: 'max-w-md mx-auto mt-10 p-6 bg-white rounded-lg shadow-lg' },
                React.createElement('h2', { className: 'text-2xl font-bold mb-4' }, 'Register'),
                error && React.createElement('p', { className: 'text-red-500' }, error),
                React.createElement(
                    'div',
                    { className: 'space-y-4' },
                    React.createElement('input', {
                        type: 'text',
                        placeholder: 'Name',
                        value: name,
                        onChange: (e) => setName(e.target.value),
                        className: 'w-full p-2 border rounded'
                    }),
                    React.createElement('input', {
                        type: 'email',
                        placeholder: 'Email',
                        value: email,
                        onChange: (e) => setEmail(e.target.value),
                        className: 'w-full p-2 border rounded'
                    }),
                    React.createElement('input', {
                        type: 'password',
                        placeholder: 'Password',
                        value: password,
                        onChange: (e) => setPassword(e.target.value),
                        className: 'w-full p-2 border rounded'
                    }),
                    React.createElement('input', {
                        type: 'text',
                        placeholder: 'Flat Number',
                        value: flatNumber,
                        onChange: (e) => setFlatNumber(e.target.value),
                        className: 'w-full p-2 border rounded'
                    }),
                    React.createElement('button', {
                        onClick: handleSubmit,
                        className: 'btn-aesthetic w-full'
                    }, 'Register'),
                    React.createElement('a', { href: '#', className: 'text-blue-500' }, 'Back to Login')
                )
            );
        }

        // Forgot Password Component
        function ForgotPassword() {
            const [email, setEmail] = useState('');
            const [message, setMessage] = useState('');

            const handleSubmit = async function (e) {
                e.preventDefault();
                try {
                    await api.forgotPassword(email);
                    setMessage('Password reset link sent!');
                } catch (err) {
                    setMessage('Error sending reset link');
                }
            };

            return React.createElement(
                'div',
                { className: 'max-w-md mx-auto mt-10 p-6 bg-white rounded-lg shadow-lg' },
                React.createElement('h2', { className: 'text-2xl font-bold mb-4' }, 'Forgot Password'),
                message && React.createElement('p', { className: message.includes('Error') ? 'text-red-500' : 'text-green-500' }, message),
                React.createElement(
                    'div',
                    { className: 'space-y-4' },
                    React.createElement('input', {
                        type: 'email',
                        placeholder: 'Email',
                        value: email,
                        onChange: (e) => setEmail(e.target.value),
                        className: 'w-full p-2 border rounded'
                    }),
                    React.createElement('button', {
                        onClick: handleSubmit,
                        className: 'btn-aesthetic w-full'
                    }, 'Send Reset Link'),
                    React.createElement('a', { href: '#', className: 'text-blue-500' }, 'Back to Login')
                )
            );
        }

        // Calendar Component (Resident)
        function ResidentCalendar() {
            const [events, setEvents] = useState([]);
            const localizer = BigCalendar.momentLocalizer(moment);

            useEffect(() => {
                const fetchBookings = async function () {
                    const bookings = await api.getBookings();
                    const formattedEvents = bookings.map(booking => ({
                        title: booking.status === 'approved' ? 'Booked' : 'Pending',
                        start: new Date(booking.bookingDate),
                        end: new Date(booking.bookingDate),
                        status: booking.status
                    }));
                    setEvents(formattedEvents);
                };
                fetchBookings();
            }, []);

            const handleSelectSlot = async function ({ start }) {
                if (events.some(event => event.start.toDateString() === start.toDateString() && event.status === 'approved')) {
                    alert('This date is already booked.');
                    return;
                }
                if (window.confirm(`Book pooja for ${start.toDateString()}?`)) {
                    await api.createBooking(start);
                    setEvents([...events, { title: 'Pending', start, end: start, status: 'pending' }]);
                }
            };

            const eventStyleGetter = (event) => {
                const backgroundColor = event.status === 'approved' ? '#EF4444' : event.status === 'pending' ? '#F59E0B' : '#10B981';
                return { style: { backgroundColor } };
            };

            return React.createElement(
                'div',
                { className: 'max-w-7xl mx-auto mt-10 p-6' },
                React.createElement('h2', { className: 'text-2xl font-bold mb-4' }, 'Pooja Booking Calendar'),
                React.createElement(BigCalendar, {
                    localizer: localizer,
                    events: events,
                    startAccessor: 'start',
                    endAccessor: 'end',
                    style: { height: 500 },
                    selectable: true,
                    onSelectSlot: handleSelectSlot,
                    eventPropGetter: eventStyleGetter,
                    views: ['month'],
                    defaultView: 'month'
                }),
                React.createElement(
                    'div',
                    { className: 'mt-4' },
                    React.createElement('span', { className: 'inline-block w-4 h-4 bg-green-500 mr-2' }, ''),
                    'Available',
                    React.createElement('span', { className: 'inline-block w-4 h-4 bg-red-500 mr-2 ml-4' }, ''),
                    'Booked',
                    React.createElement('span', { className: 'inline-block w-4 h-4 bg-orange-500 mr-2 ml-4' }, ''),
                    'Pending'
                )
            );
        }

        // My Bookings Component (Resident)
        function MyBookings() {
            const [bookings, setBookings] = useState([]);

            useEffect(() => {
                const fetchBookings = async function () {
                    const data = await api.getBookings();
                    setBookings(data);
                };
                fetchBookings();
            }, []);

            return React.createElement(
                'div',
                { className: 'max-w-4xl mx-auto mt-10 p-6' },
                React.createElement('h2', { className: 'text-2xl font-bold mb-4' }, 'My Bookings'),
                React.createElement(
                    'div',
                    { className: 'space-y-4' },
                    bookings.map(booking => React.createElement(
                        'div',
                        { key: booking.id, className: 'p-4 bg-white rounded-lg shadow' },
                        React.createElement('p', null, React.createElement('strong', null, 'Date:'), ' ', new Date(booking.bookingDate).toDateString()),
                        React.createElement('p', null, React.createElement('strong', null, 'Status:'), ' ', booking.status)
                    ))
                )
            );
        }

        // Admin Dashboard Component
        function AdminDashboard() {
            const [bookings, setBookings] = useState([]);

            useEffect(() => {
                const fetchBookings = async function () {
                    const data = await api.getAdminBookings();
                    setBookings(data);
                };
                fetchBookings();
            }, []);

            const handleAction = async function (id, status) {
                await api.updateBooking(id, status);
                setBookings(bookings.map(b => b.id === id ? { ...b, status } : b));
            };

            const handleBlockDate = async function () {
                const date = prompt('Enter date to block (YYYY-MM-DD):');
                if (date) {
                    await api.blockDate(new Date(date));
                    alert('Date blocked successfully');
                }
            };

            return React.createElement(
                'div',
                { className: 'max-w-7xl mx-auto mt-10 p-6' },
                React.createElement('h2', { className: 'text-2xl font-bold mb-4' }, 'Admin Dashboard'),
                React.createElement('button', {
                    onClick: handleBlockDate,
                    className: 'btn-danger mb-4'
                }, 'Block a Date'),
                React.createElement(
                    'div',
                    { className: 'space-y-4' },
                    bookings.map(booking => React.createElement(
                        'div',
                        { key: booking.id, className: 'p-4 bg-white rounded-lg shadow' },
                        React.createElement('p', null, React.createElement('strong', null, 'User:'), ' ', booking.userName, ' (Flat: ', booking.flatNumber, ')'),
                        React.createElement('p', null, React.createElement('strong', null, 'Date:'), ' ', new Date(booking.bookingDate).toDateString()),
                        React.createElement('p', null, React.createElement('strong', null, 'Status:'), ' ', booking.status),
                        booking.status === 'pending' && React.createElement(
                            'div',
                            { className: 'mt-2' },
                            React.createElement('button', {
                                onClick: () => handleAction(booking.id, 'approved'),
                                className: 'btn-aesthetic mr-2'
                            }, 'Approve'),
                            React.createElement('button', {
                                onClick: () => handleAction(booking.id, 'rejected'),
                                className: 'btn-danger'
                            }, 'Reject')
                        )
                    ))
                )
            );
        }

        // Main App Component
        function App() {
            const { user, logout } = useContext(AuthContext);
            const [route, setRoute] = useState(window.location.hash.slice(1) || '');

            useEffect(() => {
                const handleHashChange = () => setRoute(window.location.hash.slice(1));
                window.addEventListener('hashchange', handleHashChange);
                return () => window.removeEventListener('hashchange', handleHashChange);
            }, []);

            return React.createElement(
                'div',
                { className: 'min-h-screen bg-gray-100' },
                user && React.createElement(
                    'nav',
                    { className: 'bg-blue-500 p-4 text-white flex justify-between' },
                    React.createElement(
                        'div',
                        null,
                        React.createElement('a', { href: '#calendar', className: 'mr-4' }, 'Calendar'),
                        user.role === 'resident' && React.createElement('a', { href: '#my-bookings', className: 'mr-4' }, 'My Bookings'),
                        user.role === 'admin' && React.createElement('a', { href: '#admin', className: 'mr-4' }, 'Admin Dashboard')
                    ),
                    React.createElement('button', {
                        onClick: logout,
                        className: 'btn-danger p-2 rounded'
                    }, 'Logout')
                ),
                !user && route === 'register' && React.createElement(Register),
                !user && route === 'forgot-password' && React.createElement(ForgotPassword),
                !user && route !== 'register' && route !== 'forgot-password' && React.createElement(Login),
                user && user.role === 'resident' && route === 'calendar' && React.createElement(ResidentCalendar),
                user && user.role === 'resident' && route === 'my-bookings' && React.createElement(MyBookings),
                user && user.role === 'admin' && route === 'admin' && React.createElement(AdminDashboard)
            );
        }

        // Render App
        ReactDOM.render(
            React.createElement(
                AuthProvider,
                null,
                React.createElement(App)
            ),
            document.getElementById('root')
        );
    </script>
